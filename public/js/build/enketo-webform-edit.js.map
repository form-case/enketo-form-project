{
  "version": 3,
  "sources": ["../src/enketo-webform-edit.js"],
  "sourcesContent": ["import gui from './module/gui';\nimport controller from './module/controller-webform';\nimport settings from './module/settings';\nimport connection from './module/connection';\nimport { init as initTranslator, t, localize } from './module/translator';\nimport utils from './module/utils';\n\nconst loader = document.querySelector('.main-loader');\nconst formheader = document.querySelector('.main > .paper > .form-header');\nconst survey = {\n    enketoId: settings.enketoId,\n    instanceId: settings.instanceId,\n};\nconst range = document.createRange();\n\ninitTranslator(survey)\n    .then((survey) =>\n        Promise.all([\n            connection.getFormParts(survey),\n            connection.getExistingInstance(survey),\n        ])\n    )\n    .then((responses) => {\n        const formParts = responses[0];\n        formParts.instance = responses[1].instance;\n        formParts.instanceAttachments = responses[1].instanceAttachments;\n\n        if (formParts.form && formParts.model && formParts.instance) {\n            return gui.swapTheme(formParts);\n        }\n        throw new Error(t('error.unknown'));\n    })\n    .then(connection.getMaximumSubmissionSize)\n    .then(_updateMaxSizeSetting)\n    .then(_init)\n    .catch(_showErrorOrAuthenticate);\n\nfunction _updateMaxSizeSetting(survey) {\n    if (survey.maxSize) {\n        // overwrite default max size\n        settings.maxSize = survey.maxSize;\n    }\n\n    return survey;\n}\n\nfunction _showErrorOrAuthenticate(error) {\n    loader.classList.add('fail');\n\n    if (error.status === 401) {\n        window.location.href = `${\n            settings.loginUrl\n        }?return_url=${encodeURIComponent(window.location.href)}`;\n    } else {\n        if (!Array.isArray(error)) {\n            error = [error.message || t('error.unknown')];\n        }\n\n        gui.alertLoadErrors(error, t('alert.loaderror.editadvice'));\n    }\n}\n\nfunction _init(formParts) {\n    const formFragment = range.createContextualFragment(formParts.form);\n    formheader.after(formFragment);\n    const formEl = document.querySelector('form.or');\n\n    return controller\n        .init(formEl, {\n            modelStr: formParts.model,\n            instanceStr: formParts.instance,\n            external: formParts.externalData,\n            instanceAttachments: formParts.instanceAttachments,\n            isEditing: true,\n            survey: formParts,\n        })\n        .then((form) => {\n            formParts.languages = form.languages;\n            document.querySelector('head>title').textContent =\n                utils.getTitleFromFormStr(formParts.form);\n            localize(formEl);\n        });\n}\n"],
  "mappings": "iKAOA,IAAMA,EAAS,SAAS,cAAc,cAAc,EAC9CC,EAAa,SAAS,cAAc,+BAA+B,EACnEC,EAAS,CACX,SAAUC,EAAS,SACnB,WAAYA,EAAS,UACzB,EACMC,EAAQ,SAAS,YAAY,EAEnCC,EAAeH,CAAM,EAChB,KAAMA,GACH,QAAQ,IAAI,CACRI,EAAW,aAAaJ,CAAM,EAC9BI,EAAW,oBAAoBJ,CAAM,CACzC,CAAC,CACL,EACC,KAAMK,GAAc,CACjB,IAAMC,EAAYD,EAAU,CAAC,EAI7B,GAHAC,EAAU,SAAWD,EAAU,CAAC,EAAE,SAClCC,EAAU,oBAAsBD,EAAU,CAAC,EAAE,oBAEzCC,EAAU,MAAQA,EAAU,OAASA,EAAU,SAC/C,OAAOC,EAAI,UAAUD,CAAS,EAElC,MAAM,IAAI,MAAME,EAAE,eAAe,CAAC,CACtC,CAAC,EACA,KAAKJ,EAAW,wBAAwB,EACxC,KAAKK,CAAqB,EAC1B,KAAKC,CAAK,EACV,MAAMC,CAAwB,EAEnC,SAASF,EAAsBT,EAAQ,CACnC,OAAIA,EAAO,UAEPC,EAAS,QAAUD,EAAO,SAGvBA,CACX,CAEA,SAASW,EAAyBC,EAAO,CACrCd,EAAO,UAAU,IAAI,MAAM,EAEvBc,EAAM,SAAW,IACjB,OAAO,SAAS,KAAO,GACnBX,EAAS,uBACE,mBAAmB,OAAO,SAAS,IAAI,KAEjD,MAAM,QAAQW,CAAK,IACpBA,EAAQ,CAACA,EAAM,SAAWJ,EAAE,eAAe,CAAC,GAGhDD,EAAI,gBAAgBK,EAAOJ,EAAE,4BAA4B,CAAC,EAElE,CAEA,SAASE,EAAMJ,EAAW,CACtB,IAAMO,EAAeX,EAAM,yBAAyBI,EAAU,IAAI,EAClEP,EAAW,MAAMc,CAAY,EAC7B,IAAMC,EAAS,SAAS,cAAc,SAAS,EAE/C,OAAOC,EACF,KAAKD,EAAQ,CACV,SAAUR,EAAU,MACpB,YAAaA,EAAU,SACvB,SAAUA,EAAU,aACpB,oBAAqBA,EAAU,oBAC/B,UAAW,GACX,OAAQA,CACZ,CAAC,EACA,KAAMU,GAAS,CACZV,EAAU,UAAYU,EAAK,UAC3B,SAAS,cAAc,YAAY,EAAE,YACjCC,EAAM,oBAAoBX,EAAU,IAAI,EAC5CY,EAASJ,CAAM,CACnB,CAAC,CACT",
  "names": ["loader", "formheader", "survey", "settings_default", "range", "init", "connection_default", "responses", "formParts", "gui_default", "t", "_updateMaxSizeSetting", "_init", "_showErrorOrAuthenticate", "error", "formFragment", "formEl", "controller_webform_default", "form", "utils_default", "localize"]
}
